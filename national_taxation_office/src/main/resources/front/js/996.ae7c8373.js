"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[996],{6996:function(e,l,a){a.r(l),a.d(l,{default:function(){return V}});var t=a(3396),o=a(9242),r=a(7139);const d={slot:"footer",class:"dialog-footer"};function n(e,l,a,n,u,i){const s=(0,t.up)("el-button"),m=(0,t.up)("el-input"),p=(0,t.up)("el-col"),g=(0,t.up)("el-row"),c=(0,t.up)("el-card"),h=(0,t.up)("el-table-column"),w=(0,t.up)("el-table"),v=(0,t.up)("el-scrollbar"),b=(0,t.up)("el-form-item"),U=(0,t.up)("el-option"),f=(0,t.up)("el-select"),W=(0,t.up)("el-date-picker"),V=(0,t.up)("el-form"),_=(0,t.up)("el-dialog"),y=(0,t.up)("el-pagination");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(g,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{span:8},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{placeholder:"请输入内容",modelValue:n.searchText,"onUpdate:modelValue":l[0]||(l[0]=e=>n.searchText=e),modelModifiers:{trim:!0,lazy:!0},onKeyup:(0,o.D2)(n.searchTableData,["enter"])},{append:(0,t.w5)((()=>[(0,t.Wm)(s,{class:"el-icon-search",onClick:n.searchTableData},null,8,["onClick"])])),_:1},8,["modelValue","onKeyup"])])),_:1}),(0,t.Wm)(p,{span:4},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{type:"primary",onClick:n.openAddUserDialog},{default:(0,t.w5)((()=>[(0,t.Uk)("添加用户")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(v,{style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{data:n.paginatedTableData,ref:"multipleTableRef",onSelectionChange:n.handleSelectionChange,style:{"overflow-x":"auto"}},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{type:"selection",width:"55"}),(0,t.Wm)(h,{prop:"name",label:"用户名称",width:"200"}),(0,t.Wm)(h,{prop:"password",label:"密码",width:"200"}),(0,t.Wm)(h,{prop:"dept",label:"部门",width:"200"}),(0,t.Wm)(h,{prop:"company",label:"公司",width:"200"}),(0,t.Wm)(h,{prop:"gender",label:"性别",width:"200"},{default:(0,t.w5)((e=>[(0,t._)("span",null,(0,r.zw)(0===e.row.gender?"女生":"男生"),1)])),_:1}),(0,t.Wm)(h,{label:"状态",prop:"state",width:"200"},{default:(0,t.w5)((e=>[(0,t._)("span",null,(0,r.zw)(0===e.row.state?"禁用":"正常"),1)])),_:1}),(0,t.Wm)(h,{prop:"mobile",label:"手机号码",width:"200"}),(0,t.Wm)(h,{prop:"email",label:"邮箱",width:"200"}),(0,t.Wm)(h,{prop:"birthday",label:"生日",width:"200"}),(0,t.Wm)(h,{prop:"account",label:"工号",width:"200"}),(0,t.Wm)(h,{prop:"headImg",label:"图像url",width:"200"}),(0,t.Wm)(h,{prop:"memo",label:"备注",width:"200"}),(0,t.Wm)(h,{prop:"role",label:"用户角色",width:"200"}),(0,t.Wm)(h,{label:"操作",width:"200"},{default:(0,t.w5)((e=>[(0,t.Wm)(s,{type:"primary",onClick:l=>n.editUser(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("编辑")])),_:2},1032,["onClick"]),(0,t.Wm)(s,{type:"danger",onClick:l=>n.deleteUser(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])])),_:1}),(0,t.Wm)(_,{modelValue:n.showAddUserDialog,"onUpdate:modelValue":l[14]||(l[14]=e=>n.showAddUserDialog=e),title:"添加用户",onClose:n.resetEditingRole},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{model:n.editingUser,"label-width":"100px",rules:n.formRules,ref:"addRoleForm"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{label:"用户名称",prop:"name"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.name,"onUpdate:modelValue":l[1]||(l[1]=e=>n.editingUser.name=e),disabled:n.editingUser.editing},null,8,["modelValue","disabled"])])),_:1}),(0,t.Wm)(b,{label:"密码",prop:"password"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.password,"onUpdate:modelValue":l[2]||(l[2]=e=>n.editingUser.password=e),type:"password"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"部门",prop:"dept"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.dept,"onUpdate:modelValue":l[3]||(l[3]=e=>n.editingUser.dept=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"公司",prop:"company"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.company,"onUpdate:modelValue":l[4]||(l[4]=e=>n.editingUser.company=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"性别",prop:"gender"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:n.editingUser.gender,"onUpdate:modelValue":l[5]||(l[5]=e=>n.editingUser.gender=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{label:"男",value:!0}),(0,t.Wm)(U,{label:"女",value:!1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"用户状态",prop:"state"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:n.editingUser.state,"onUpdate:modelValue":l[6]||(l[6]=e=>n.editingUser.state=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{label:"正常",value:1}),(0,t.Wm)(U,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"手机号码",prop:"mobile"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.mobile,"onUpdate:modelValue":l[7]||(l[7]=e=>n.editingUser.mobile=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"邮箱",prop:"email"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.email,"onUpdate:modelValue":l[8]||(l[8]=e=>n.editingUser.email=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"生日",prop:"birthday"},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{modelValue:n.editingUser.birthday,"onUpdate:modelValue":l[9]||(l[9]=e=>n.editingUser.birthday=e),type:"date",placeholder:"选择日期"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"工号",prop:"account"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.account,"onUpdate:modelValue":l[10]||(l[10]=e=>n.editingUser.account=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"图像url",prop:"headImg"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.headImg,"onUpdate:modelValue":l[11]||(l[11]=e=>n.editingUser.headImg=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"备注",prop:"memo"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:n.editingUser.memo,"onUpdate:modelValue":l[12]||(l[12]=e=>n.editingUser.memo=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"用户角色",prop:"role"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:n.editingUser.role,"onUpdate:modelValue":l[13]||(l[13]=e=>n.editingUser.role=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{label:"个人空间与纳税服务",value:1}),(0,t.Wm)(U,{label:"个人空间",value:2})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),(0,t._)("div",d,[(0,t.Wm)(s,{onClick:n.cancelAddUser},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1},8,["onClick"]),(0,t.Wm)(s,{type:"primary",onClick:n.saveUser},{default:(0,t.w5)((()=>[(0,t.Uk)("保存")])),_:1},8,["onClick"])])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)(y,{onSizeChange:n.handlePageSizeChange,onCurrentChange:n.handleCurrentPageChange,"current-page":n.currentPage,"page-sizes":[10,20,30,50],"page-size":n.pageSize,total:n.filteredTableData.length,layout:"sizes, prev, pager, next, jumper",class:"pagination-centered"},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])}a(7658);var u=a(4870),i=a(4161),s=a(491),m=a(4550),p=a(7947),g=a(6e3),c=a(1955),h=a(3417),w=a(2261),v=a(7178),b=a(3191),U={components:{ElTable:m.eI,ElDialog:p.d0,ElMessageBox:g.T,ElForm:c.ly,ElFormItem:c.nH,ElInput:h.EZ,ElButton:w.ElButton,ElMessage:v.z8,ElPagination:b.R},setup(){const e=80,l=(0,u.iH)(""),a=(0,u.iH)([]),o=(0,u.iH)([]),r=(0,u.iH)([]),d=(0,u.iH)(!1),n=(0,u.iH)({}),m=(0,u.iH)(),p=(0,u.iH)([]),c=(0,u.iH)(1),h=(0,u.iH)(5),w=(0,u.iH)(0),b={name:[{required:!0,message:"用户名称不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],dept:[{required:!0,message:"部门不能为空",trigger:"blur"}],company:[{required:!0,message:"公司不能为空",trigger:"blur"}],gender:[{required:!0,message:"性别不能为空",trigger:"blur"}],state:[{required:!0,message:"用户状态不能为空",trigger:"blur"}],mobile:[{required:!0,message:"手机号码不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],birthday:[{required:!0,message:"生日不能为空",trigger:"change"}],account:[{required:!0,message:"账户信息不能为空",trigger:"blur"}],role:[{required:!0,message:"用户角色不能为空",trigger:"blur"}]},U=async()=>{try{const l=await s.Z.fetchUser();console.log(l);for(let a=0;a<l.length;a++){const t=l[a].id;console.log(t);const o=await i.Z.get(`http://localhost:${e}/users/getRoleId/${t}`);console.log(o.data),o&&(l[a].role=o.data)}console.log(l),a.value=l,r.value=[...data],o.value=a}catch(l){}};(0,t.bv)((()=>{U()}));const f=()=>{if(c.value=1,p.value=[],l.value){const e=l.value.trim().toLowerCase(),t=a.value.filter((l=>l.name.toLowerCase().includes(e)));0===t.length?g.T.alert("查询失败","提示",{type:"error"}):(o.value=t,w.value=Math.ceil(t.length/h.value))}else o.value=a.value},W=e=>{d.value=!0,n.value={...e,editing:!0,operation:"editUserOperation"}},V=async l=>{console.log(l);const t=l.id;console.log(t),console.log(l);try{await i.Z.delete(`http://localhost:${e}/users/delete/${t}`),a.value=a.value.filter((e=>e.id!==t)),o.value=o.value.filter((e=>e.id!==t))}catch(r){console.error("Error deleting role:",r)}},_=()=>{d.value=!0,n.value={editing:!1,operation:"addUserOperation"}},y=()=>{d.value=!1,n.value={}},C=async()=>{if(n.value.name&&n.value.account&&n.value.birthday&&n.value.company&&n.value.dept&&n.value.email&&n.value.mobile&&n.value.password){if(n.value.editing){const l={...n.value};delete l.operation,delete l.editing,delete l.role;const t=await i.Z.put(`http://localhost:${e}/users/update/${l.id}`,{data:l});console.log(t);const o=a.value.findIndex((e=>e.name===n.value.name));-1!==o&&(a.value[o]={...n.value,editing:!1})}else{const l=a.value.find((e=>e.name===n.value.name));if(l)return void v.z8.warning("该用户已存在");const t={userId:a.value.length+1,roleId:n.value.role};await i.Z.post(`http://localhost:${e}/users/setUserRole?roleId=${t.roleId}&userId=${t.userId}`);const o={...n.value,id:a.value.length+1,admin:0};delete o.operation,delete o.editing,delete o.role;const r=await i.Z.post(`http://localhost:${e}/users/addUser`,o);console.log(r),a.value.push({...n.value})}d.value=!1,n.value={}}else v.z8.warning("请填写必要信息")},k=()=>{n.value={}},z=e=>{p.value=e},D=(0,t.Fl)((()=>{const e=(c.value-1)*h.value,l=e+h.value;return w.value=Math.ceil(o.value.length/h.value),o.value.slice(e,l)})),I=e=>{h.value=e,c.value=1},T=e=>{const l=Math.ceil(o.value.length/h.value);c.value=Math.max(1,Math.min(e,l))};return(0,t.YP)(a,(e=>{o.value=e})),{searchText:l,tableData:a,showAddUserDialog:d,editingUser:n,multipleTableRef:m,multipleSelection:p,currentPage:c,pageSize:h,totalPages:w,filteredTableData:o,formRules:b,searchTableData:f,editUser:W,deleteUser:V,openAddUserDialog:_,cancelAddUser:y,saveUser:C,resetEditingRole:k,handleSelectionChange:z,paginatedTableData:D,handlePageSizeChange:I,handleCurrentPageChange:T}}},f=a(89);const W=(0,f.Z)(U,[["render",n]]);var V=W}}]);
//# sourceMappingURL=996.ae7c8373.js.map